# Deployment Configuration Changes

## Summary

Your project has been configured for production deployment on **Netlify** (frontend) and **Render** (backend).

---

## ‚úÖ Files Created/Modified

### Frontend Configuration

1. **`frontend/netlify.toml`** ‚ú® NEW
   - Netlify deployment configuration
   - Handles React Router redirects
   - Configures caching for static assets

2. **`frontend/.env`** ‚ú® NEW
   - Local development environment variables
   - Sets `REACT_APP_API_BASE_URL=http://127.0.0.1:8000/api`

3. **`frontend/.env.production`** ‚ú® NEW
   - Production build environment variables
   - Update `REACT_APP_API_BASE_URL` with your Render backend URL

4. **`frontend/.env.example`** ‚ú® NEW
   - Template for environment variables
   - Documents required variables

5. **`frontend/src/services/api.ts`** üîß MODIFIED
   - Now uses `process.env.REACT_APP_API_BASE_URL`
   - Falls back to localhost if not set

6. **`frontend/src/pages/CertificateDetail/CertificateDetail.tsx`** üîß MODIFIED
   - PDF download URL now uses environment variable
   - Works in both development and production

---

### Backend Configuration

1. **`backend/backend/settings/settings.py`** üîß MODIFIED
   - Added `import os` for environment variables
   - `SECRET_KEY` now uses `DJANGO_SECRET_KEY` env var
   - `DEBUG` now uses `DEBUG` env var
   - `ALLOWED_HOSTS` now uses `ALLOWED_HOSTS` env var
   - Added `FRONTEND_URL` setting for QR code generation
   - `CORS_ALLOWED_ORIGINS` now uses env var
   - Added `CORS_ALLOW_ALL_ORIGINS = True` for production

2. **`backend/apps/certificates/models.py`** üîß MODIFIED
   - `generate_qr_code()` method now uses `settings.FRONTEND_URL`
   - QR codes will contain correct production URL

3. **`backend/.env.example`** ‚ú® NEW
   - Template for backend environment variables
   - Documents all required variables

4. **`backend/build.sh`** ‚ú® NEW
   - Render build script
   - Installs dependencies, collects static files, runs migrations

---

### Deployment Configuration

1. **`render.yaml`** ‚ú® NEW
   - Render deployment configuration
   - Defines web service settings
   - Configures environment variables
   - Sets up persistent disk for media files

2. **`DEPLOYMENT_GUIDE.md`** ‚ú® NEW
   - Complete step-by-step deployment instructions
   - Covers both Netlify and Render
   - Includes troubleshooting section
   - QR code functionality explanation

---

## üîë Environment Variables Reference

### Frontend (Netlify)

| Variable | Development | Production |
|----------|-------------|------------|
| `REACT_APP_API_BASE_URL` | `http://127.0.0.1:8000/api` | `https://your-backend.onrender.com/api` |

### Backend (Render)

| Variable | Development | Production |
|----------|-------------|------------|
| `DJANGO_SECRET_KEY` | Local secret | Auto-generated by Render |
| `DEBUG` | `True` | `False` |
| `ALLOWED_HOSTS` | `localhost,127.0.0.1` | `your-backend.onrender.com` |
| `FRONTEND_URL` | `http://localhost:3000` | `https://your-frontend.netlify.app` |
| `CORS_ALLOWED_ORIGINS` | `http://localhost:3000` | `https://your-frontend.netlify.app` |

---

## üì¶ How It Works

### Development (localhost)

```
Frontend (React)                Backend (Django)
http://localhost:3000  ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚Üí  http://127.0.0.1:8000
     ‚îÇ                               ‚îÇ
     ‚îî‚îÄ Uses .env file               ‚îî‚îÄ Uses default settings
```

### Production

```
Frontend (Netlify)              Backend (Render)
https://your-app.netlify.app ‚Üê‚Üí https://your-backend.onrender.com
     ‚îÇ                               ‚îÇ
     ‚îî‚îÄ REACT_APP_API_BASE_URL       ‚îú‚îÄ CORS allows Netlify
     ‚îî‚îÄ Build: npm run build         ‚îú‚îÄ Media files on disk
                                     ‚îî‚îÄ QR codes point to Netlify
```

---

## üéØ QR Code Functionality

### How QR Codes Work Live

1. **Certificate Created:**
   - Django generates certificate in database
   - `generate_qr_code()` is called automatically
   - QR code contains: `https://your-frontend.netlify.app/certificate/{id}`

2. **QR Code Stored:**
   - Saved to: `/media/certificate_qr_codes/qr_CERT-2025-XXXXX.png`
   - Accessible via: `https://your-backend.onrender.com/media/certificate_qr_codes/qr_CERT-2025-XXXXX.png`

3. **User Scans QR Code:**
   - Phone redirects to: `https://your-frontend.netlify.app/certificate/{id}`
   - Frontend fetches data from backend API
   - Shows **live** certificate status (Valid, Expired, etc.)

4. **PDF Download:**
   - PDF includes embedded QR code image
   - Scanning QR code from printed PDF works!
   - Always shows current status (even if certificate expires after printing)

### Answer to Your Question: "Does the QR code work when live?"

**‚úÖ YES, absolutely!**

- QR codes are generated with your production frontend URL
- They redirect to the live certificate page
- The page fetches real-time data from the API
- Status updates automatically (e.g., if certificate expires)
- Works from printed PDFs as well as digital certificates

---

## üöÄ Next Steps

1. **Deploy Backend to Render:**
   - Follow `DEPLOYMENT_GUIDE.md` ‚Üí Backend Deployment section
   - Get your Render URL (e.g., `https://msccert-backend.onrender.com`)

2. **Deploy Frontend to Netlify:**
   - Follow `DEPLOYMENT_GUIDE.md` ‚Üí Frontend Deployment section
   - Set `REACT_APP_API_BASE_URL` to your Render backend URL
   - Get your Netlify URL (e.g., `https://your-app.netlify.app`)

3. **Update Backend Environment Variables:**
   - Set `FRONTEND_URL` to your Netlify URL
   - Set `CORS_ALLOWED_ORIGINS` to your Netlify URL
   - Set `ALLOWED_HOSTS` to your Render domain

4. **Test QR Codes:**
   - Create a test certificate via Django admin
   - Download PDF
   - Scan QR code with phone
   - Verify it opens the live certificate page

---

## üîí Security Notes

- ‚úÖ `.env` files are in `.gitignore` (secrets not committed)
- ‚úÖ `DEBUG=False` in production
- ‚úÖ `SECRET_KEY` auto-generated by Render
- ‚úÖ CORS restricted to your Netlify domain
- ‚úÖ HTTPS enforced by both Netlify and Render

---

## üìù Git Status

Before deployment, commit these changes:

```bash
git add .
git commit -m "Configure for Netlify and Render deployment"
git push origin main
```

New files to commit:
- `frontend/netlify.toml`
- `frontend/.env.example`
- `backend/.env.example`
- `backend/build.sh`
- `render.yaml`
- `DEPLOYMENT_GUIDE.md`
- `DEPLOYMENT_CHANGES.md`

Modified files to commit:
- `frontend/src/services/api.ts`
- `frontend/src/pages/CertificateDetail/CertificateDetail.tsx`
- `backend/backend/settings/settings.py`
- `backend/apps/certificates/models.py`

Files **NOT** to commit (already in .gitignore):
- `frontend/.env`
- `frontend/.env.production`
- `backend/.env`

---

## üí° Tips

1. **Free Tier Limitations:**
   - Render: Backend sleeps after 15 min inactivity (cold start: 30-60s)
   - Netlify: 100GB bandwidth/month (plenty for most apps)

2. **Upgrade When Needed:**
   - Render Starter ($7/month): Always on, no sleep
   - PostgreSQL ($7/month): Better than SQLite for production

3. **Monitor Your Apps:**
   - Check logs regularly on both platforms
   - Set up uptime monitoring (e.g., UptimeRobot)

4. **Custom Domains:**
   - Both Netlify and Render support custom domains
   - Free SSL certificates included

---

**üéâ Your app is ready for deployment!**

Follow the `DEPLOYMENT_GUIDE.md` for detailed step-by-step instructions.
