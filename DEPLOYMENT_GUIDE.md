# üöÄ Deployment Guide - MSC Certifications Web Service

This guide will help you deploy your MSC Certifications application to production using **Render** (backend) and **Netlify** (frontend).

---

## üìã Table of Contents

1. [Prerequisites](#prerequisites)
2. [Backend Deployment (Render)](#backend-deployment-render)
3. [Frontend Deployment (Netlify)](#frontend-deployment-netlify)
4. [Environment Configuration](#environment-configuration)
5. [QR Code Functionality](#qr-code-functionality)
6. [Troubleshooting](#troubleshooting)
7. [Post-Deployment Tasks](#post-deployment-tasks)

---

## Prerequisites

Before deploying, ensure you have:

- ‚úÖ GitHub account (to connect to Render and Netlify)
- ‚úÖ Your code pushed to a GitHub repository
- ‚úÖ Render account (free tier available)
- ‚úÖ Netlify account (free tier available)

---

## Backend Deployment (Render)

### Step 1: Push Code to GitHub

```bash
cd C:\Users\arlin\Desktop\msccert_webservice
git add .
git commit -m "Prepare for deployment"
git push origin main
```

### Step 2: Create Render Web Service

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** ‚Üí **"Web Service"**
3. Connect your GitHub repository
4. Configure the service:

   **Basic Settings:**
   - **Name**: `msccert-backend` (or your preferred name)
   - **Region**: Choose closest to your users (e.g., Oregon)
   - **Branch**: `main`
   - **Root Directory**: `backend`
   - **Runtime**: `Python 3`
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn --bind 0.0.0.0:$PORT backend.wsgi:application`

5. Click **"Advanced"** and add environment variables:

   | Key | Value |
   |-----|-------|
   | `PYTHON_VERSION` | `3.11.0` |
   | `DJANGO_SECRET_KEY` | *(Click "Generate" to auto-generate)* |
   | `DEBUG` | `False` |
   | `ALLOWED_HOSTS` | *(Leave blank for now, will update after deploy)* |
   | `FRONTEND_URL` | *(Leave blank for now, will update after frontend deploy)* |
   | `CORS_ALLOWED_ORIGINS` | *(Leave blank for now, will update after frontend deploy)* |

6. **Add Disk for Media Files:**
   - Scroll down to **"Disk"**
   - Click **"Add Disk"**
   - **Name**: `media`
   - **Mount Path**: `/opt/render/project/src/backend/media`
   - **Size**: `1 GB` (free tier)

7. Click **"Create Web Service"**

8. Wait for deployment to complete (5-10 minutes)

9. Once deployed, you'll get a URL like: `https://msccert-backend.onrender.com`

### Step 3: Update Backend Environment Variables

After deployment, update these environment variables in Render:

1. Go to your service ‚Üí **"Environment"**
2. Update the following:

   | Key | New Value |
   |-----|-----------|
   | `ALLOWED_HOSTS` | `msccert-backend.onrender.com` *(use your actual Render URL without https://)* |

3. Click **"Save Changes"** (will trigger a redeploy)

---

## Frontend Deployment (Netlify)

### Step 1: Build Frontend Locally (Test)

Before deploying, test the production build:

```bash
cd frontend
npm run build
```

Ensure build completes without errors.

### Step 2: Deploy to Netlify

1. Go to [Netlify Dashboard](https://app.netlify.com/)
2. Click **"Add new site"** ‚Üí **"Import an existing project"**
3. Connect your GitHub repository
4. Configure build settings:

   **Basic Settings:**
   - **Base directory**: `frontend`
   - **Build command**: `npm run build`
   - **Publish directory**: `frontend/build`
   - **Branch**: `main`

5. Click **"Advanced"** and add environment variable:

   | Key | Value |
   |-----|-------|
   | `REACT_APP_API_BASE_URL` | `https://msccert-backend.onrender.com/api` *(use your actual Render URL)* |

6. Click **"Deploy site"**

7. Wait for deployment (2-5 minutes)

8. Once deployed, Netlify will assign a URL like: `https://random-name-12345.netlify.app`

### Step 3: Configure Custom Domain (Optional)

1. Go to **"Site settings"** ‚Üí **"Domain management"**
2. Click **"Add custom domain"**
3. Follow Netlify's instructions to configure your DNS

---

## Environment Configuration

### Update Backend with Frontend URL

After deploying frontend, go back to Render and update:

1. Go to your backend service ‚Üí **"Environment"**
2. Update these variables:

   | Key | Value |
   |-----|-------|
   | `FRONTEND_URL` | `https://your-frontend.netlify.app` *(your actual Netlify URL)* |
   | `CORS_ALLOWED_ORIGINS` | `https://your-frontend.netlify.app` *(your actual Netlify URL)* |

3. Click **"Save Changes"**

### Final Environment Variables Summary

**Backend (Render):**
```
PYTHON_VERSION=3.11.0
DJANGO_SECRET_KEY=<auto-generated>
DEBUG=False
ALLOWED_HOSTS=msccert-backend.onrender.com
FRONTEND_URL=https://your-frontend.netlify.app
CORS_ALLOWED_ORIGINS=https://your-frontend.netlify.app
```

**Frontend (Netlify):**
```
REACT_APP_API_BASE_URL=https://msccert-backend.onrender.com/api
```

---

## QR Code Functionality

### How QR Codes Work in Production

‚úÖ **Yes, QR codes work when live!** Here's how:

1. **QR Code Generation:**
   - When a certificate is created, Django automatically generates a QR code
   - The QR code contains a URL to the live certificate detail page
   - URL format: `https://your-frontend.netlify.app/certificate/{id}`

2. **QR Code Storage:**
   - QR codes are stored in Render's persistent disk (`/media/certificate_qr_codes/`)
   - They are accessible via: `https://msccert-backend.onrender.com/media/certificate_qr_codes/qr_CERT-2025-XXXXX.png`

3. **Scanning QR Codes:**
   - Users scan the QR code with their phone
   - They are redirected to the live certificate page on your Netlify frontend
   - The certificate shows **real-time status** (valid, expired, suspended, etc.)

4. **PDF Downloads with QR Codes:**
   - PDFs include the QR code embedded
   - Users can download and print certificates with QR codes
   - Scanning the QR code from a printed PDF will still work!

### Testing QR Codes

After deployment:

1. Go to Django admin: `https://msccert-backend.onrender.com/admin`
2. Create a test certificate
3. Download the PDF (should include QR code)
4. Scan the QR code with your phone
5. Verify it redirects to the live certificate page

---

## Troubleshooting

### Common Issues

#### 1. Port Scan Timeout on Render

**Error:** `Timed out: Port scan timeout reached, no open ports detected. Bind your service to at least one port.`

**Solution:**
The start command must bind to the PORT environment variable that Render provides:

‚úÖ **Correct:**
```
gunicorn --bind 0.0.0.0:$PORT backend.wsgi:application
```

‚ùå **Wrong:**
```
gunicorn backend.wsgi:application
```

**Fix in Render Dashboard:**
1. Go to your service ‚Üí **"Settings"**
2. Scroll to **"Build & Deploy"** section
3. Update **Start Command** to: `gunicorn --bind 0.0.0.0:$PORT backend.wsgi:application`
4. Click **"Save Changes"**
5. Trigger a manual deploy

#### 2. Backend Build Fails on Render

**Error:** `ModuleNotFoundError: No module named 'X'`

**Solution:**
- Ensure all dependencies are in `backend/requirements.txt`
- Check Python version matches (3.11.0)

#### 3. Frontend Shows "Failed to fetch certificates"

**Possible causes:**
- Backend not running or CORS not configured
- Wrong `REACT_APP_API_BASE_URL` in Netlify

**Solution:**
1. Check backend logs on Render
2. Verify `CORS_ALLOWED_ORIGINS` includes your Netlify URL
3. Test API directly: `https://msccert-backend.onrender.com/api/certificates/`

#### 4. QR Codes Not Loading

**Error:** 404 on QR code images

**Solution:**
- Ensure disk is mounted correctly on Render (`/opt/render/project/src/backend/media`)
- Check `MEDIA_URL` and `MEDIA_ROOT` in settings.py
- Regenerate certificates to create new QR codes

#### 5. Static Files Not Loading on Backend

**Error:** CSS/JS not loading on Django admin

**Solution:**
```bash
# In Render shell (via Dashboard ‚Üí "Shell")
python manage.py collectstatic --no-input
```

Or add to `build.sh` (already included).

#### 6. Render Free Tier Sleep Mode

**Issue:** Backend goes to sleep after 15 minutes of inactivity

**Solution:**
- Upgrade to paid plan ($7/month) for always-on service
- Or accept 30-60 second cold start on first request

---

## Post-Deployment Tasks

### 1. Create Django Superuser

Access Render shell:

1. Go to Render Dashboard ‚Üí Your service
2. Click **"Shell"** tab
3. Run:
   ```bash
   python manage.py createsuperuser
   ```
4. Follow prompts to create admin account

### 2. Access Django Admin

- URL: `https://msccert-backend.onrender.com/admin`
- Login with superuser credentials
- Start creating certificates!

### 3. Test Complete Flow

1. Create a certificate via Django admin
2. Verify QR code is generated
3. View certificate list on frontend
4. Click on a certificate to view details
5. Download PDF
6. Scan QR code from PDF

### 4. Monitor Logs

**Backend Logs (Render):**
- Go to Dashboard ‚Üí Your service ‚Üí **"Logs"** tab
- Watch for errors

**Frontend Logs (Netlify):**
- Go to Dashboard ‚Üí Your site ‚Üí **"Functions"** ‚Üí **"Logs"**
- Or check browser console for JavaScript errors

### 5. Set Up Continuous Deployment

Both Render and Netlify are already configured for auto-deploy:
- Push to `main` branch on GitHub
- Services will automatically rebuild and deploy

---

## Database Considerations

### Current Setup: SQLite

- ‚úÖ Simple, no configuration needed
- ‚úÖ Good for small to medium traffic
- ‚ö†Ô∏è Limited to 1GB on Render free tier
- ‚ö†Ô∏è Not suitable for high traffic or multiple dynos

### Upgrade to PostgreSQL (Recommended for Production)

If you expect high traffic or multiple users creating certificates simultaneously:

1. **Create PostgreSQL Database on Render:**
   - Dashboard ‚Üí **"New +"** ‚Üí **"PostgreSQL"**
   - Choose free tier (will delete after 90 days) or paid tier

2. **Update Backend Settings:**

   Add to `backend/backend/settings/settings.py`:
   ```python
   import dj_database_url

   if 'DATABASE_URL' in os.environ:
       DATABASES = {
           'default': dj_database_url.config(
               conn_max_age=600,
               conn_health_checks=True,
           )
       }
   ```

3. **Install dj-database-url:**

   Add to `requirements.txt`:
   ```
   dj-database-url
   ```

4. **Add Environment Variable on Render:**
   - Copy the `DATABASE_URL` from your PostgreSQL database
   - Add it to your web service environment variables

5. **Migrate Data:**
   ```bash
   python manage.py migrate
   ```

---

## Security Best Practices

### 1. Never Commit Secrets

Ensure `.gitignore` includes:
```
.env
*.env.local
db.sqlite3
backend/media/
```

### 2. Use Strong Secret Key

Let Render generate `DJANGO_SECRET_KEY` automatically.

### 3. Keep DEBUG=False in Production

Always set `DEBUG=False` on Render.

### 4. Restrict ALLOWED_HOSTS and CORS

Only allow your specific domains:
```
ALLOWED_HOSTS=msccert-backend.onrender.com
CORS_ALLOWED_ORIGINS=https://your-frontend.netlify.app
```

### 5. Enable HTTPS Only

Both Render and Netlify provide free SSL certificates automatically.

---

## Cost Estimate

| Service | Plan | Cost | What You Get |
|---------|------|------|--------------|
| **Render** | Free | $0/month | 750 hours/month, goes to sleep after 15 min inactivity |
| **Render** | Starter | $7/month | Always on, no sleep mode |
| **Render Disk** | Free | $0/month | 1GB storage |
| **Netlify** | Free | $0/month | 100GB bandwidth, unlimited builds |
| **PostgreSQL** | Free | $0/month | 90 days free, then $7/month |

**Recommended for production:** $7-14/month (Starter plan + PostgreSQL)

---

## Support and Resources

- **Render Docs:** https://render.com/docs
- **Netlify Docs:** https://docs.netlify.com/
- **Django Deployment:** https://docs.djangoproject.com/en/5.2/howto/deployment/
- **Create React App Deployment:** https://create-react-app.dev/docs/deployment/

---

## Summary Checklist

- [ ] Backend deployed to Render
- [ ] Frontend deployed to Netlify
- [ ] Environment variables configured correctly
- [ ] CORS configured with frontend URL
- [ ] QR codes working (test by creating a certificate)
- [ ] Django superuser created
- [ ] PDF download working
- [ ] Custom domain configured (optional)
- [ ] Monitoring set up (logs)

---

**üéâ Congratulations! Your MSC Certifications app is now live!**

Your users can now:
- View certificates online
- Scan QR codes for live status
- Download PDFs with embedded QR codes
- Access certificates from anywhere in the world

**Live URLs:**
- Frontend: `https://your-frontend.netlify.app`
- Backend API: `https://msccert-backend.onrender.com/api`
- Django Admin: `https://msccert-backend.onrender.com/admin`

---

**Need help?** Feel free to ask questions about any step in this guide!
